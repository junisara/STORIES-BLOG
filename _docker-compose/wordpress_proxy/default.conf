server {
    listen 80;
    listen [::]:80;
    server_name wp.junisara.myds.me *.stories.pe.kr; # 보안을 위해 설정된 서버로 접근때만 아래 설정이 적용됨(일반적으로 도메인명을 작성함)
#    server_name _;  # 일단은 모든 접근을 허용함으로 테스트 해봄

    root /var/www/html;
    index index.php;

    location / {
        try_files $uri $uri/ /index.php?$args;
    }

    rewrite /wp-admin$ $scheme://$host$uri/ permanent;

    location ~ [^/]\.php(/|$) {
        fastcgi_split_path_info ^(.+?\.php)(/.*)$;
        if (!-f $document_root$fastcgi_script_name) {
            return 404;
        }

        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO       $fastcgi_path_info;
        fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;

        fastcgi_pass   wordpress:9000;  # PHP-FPM 주소로 수정
        fastcgi_index  index.php;
    }
}


# 코드를 그대로 사용시 server_name, fastcgi_pass, ssl path 정도만 수정하면 되리라.

# server {
#     listen 80;
#     server_name wp.junisara.myds.me;;

#     location / {
#         rewrite ^ https://$host$request_uri? permanent;
#     }
# }

# server {
#     listen 443 ssl http2;
#     listen [::]:443 ssl http2;
#     server_name wp.junisara.myds.me;;

#   root /var/www/html;

#   index index.php;

#   location / {
#     try_files $uri $uri/ /index.php?$args;
#   }

#   rewrite /wp-admin$ $scheme://$host$uri/ permanent;

#   location ~ [^/]\.php(/|$) {
#     fastcgi_split_path_info ^(.+?\.php)(/.*)$;
#     if (!-f $document_root$fastcgi_script_name) {
#       return 404;
#     }

#     include fastcgi_params;
#     fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#     fastcgi_param PATH_INFO       $fastcgi_path_info;
#     fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;

#     fastcgi_pass   blog:9000;
#     fastcgi_index  index.php;
#   }

#     ssl_certificate /app/cert/eocis.app.cer;
#     ssl_certificate_key /app/cert/eocis.app.key;
#     ssl_prefer_server_ciphers on;
#     ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
# }